<!DOCTYPE html>
<html lang="en">

<head>
    <title>Blog Page</title>
    <%- include('./partials/head') %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
</head>

<body>
    <%- include('./partials/navbar') %>

    <% if (locals.error) { %>
        <div class="alert alert-danger text-center mt-3" role="alert">
            <strong>Error:</strong> <%= locals.error %>
        </div>
    <% } else { %>
        <div class="container mt-5" style="width: 75%;">
            <!-- Blog Content -->
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="card mb-4 shadow-lg border-0">
                        <img src="<%= locals.blog.coverImageUrl %>" class="card-img-top img-fluid rounded-top" alt="<%= locals.blog.title %>">
                        <div class="card-body">
                            <h1 class="card-title display-5 text-center mb-4"><%= locals.blog.title %></h1>
                            <div class="card-text lead text-muted mb-4" style="white-space: pre-wrap;"><%- locals.blog.body %></div>
                            <div class="d-flex align-items-center border-top pt-3">
                                <img src="<%= locals.user.profilePictureURL %>" class="rounded-circle me-3 border border-dark" width="60" height="60" alt="Profile Picture">
                                <div>
                                    <p class="mb-0 fw-bold">Published by <%= locals.blog.generatedBy.fullName %></p>
                                    <p class="text-muted small mb-0">Author</p>
                                </div>
                                <div class="ms-auto text-muted small text-end">
                                    <p class="mb-0"><i class="bi bi-calendar"></i> <%= new Date(locals.blog.createdAt).toLocaleDateString() %></p>
                                    <p class="mb-0"><i class="bi bi-clock"></i> <%= new Date(locals.blog.createdAt).toLocaleTimeString() %></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comments Section -->
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="card shadow-sm border-0">
                        <div class="card-body">
                            <h3 class="card-title">Comments (<%= locals.comments.length %>)</h3>
                            <% locals.comments.forEach(comment => { %>
                                <div class="d-flex align-items-start mt-4">
                                    <img src="<%= comment.generatedBy.profilePictureURL %>" class="rounded-circle me-3 border" width="50" alt="Profile Picture">
                                    <div>
                                        <p class="mb-1 fw-bold"><%= comment.generatedBy.fullName %></p>
                                        <p class="mb-2 text-muted small" style="white-space: pre-wrap;"><%- comment.content %></p>
                                    </div>
                                </div>
                                <hr>
                            <% }) %>

                            <!-- Add a Comment -->
                            <% if (locals.user) { %>
                                <form method="post" action="/blogs/comment/<%= locals.blog._id %>" class="mt-3">
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="commentInput" name="content" placeholder="Add a comment..." required>
                                        <button class="btn btn-primary" type="submit">Add</button>
                                    </div>
                                </form>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <% } %>

    <%- include('./partials/script') %>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

</body>

</html>
